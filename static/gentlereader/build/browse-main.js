define("utils/ignore-articles",[],function(){var e;return e=function(e){return e.match(/^the /i)?e.substring(4):e.match(/^an /i)?e.substring(3):e.match(/^a /i)?e.substring(2):e}}),define("models/tag-set",["backbone","utils/ignore-articles"],function(e,t){var a;return a=e.Collection.extend({comparator:function(e){var a,s,n;return a=e.has("last_name"),n=e.has("teaser"),s=a?e.get("last_name"):n?e.get("date_entered"):e.get("name"),t(s.toLowerCase())}})}),require.config({paths:{jade:"/static/gentlereader/scripts/lib/jade-runtime"},shim:{jade:{exports:"jade"}}}),define("templates/pgSelectTempl",["jade"],function(jade){function pgSelectTempl(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('\n<div data-adjustor="page" class="x-adjustor">&times;</div>\n<div class="adjustor-h">Pages</div>\n<ol start="0" id="pagelist">\n  <li data-page="all" class="page-all pagelist-i">all '+escape(null==(interp=itemCount)?"":interp)+" "+escape(null==(interp=dataType)?"":interp)+"</li>"),function(){if("number"==typeof pages.length)for(var e=0,t=pages.length;t>e;e++){var a=pages[e];buf.push("\n  <li"),buf.push(attrs({"data-page":""+a.num,"class":"pagelist-i"},{"data-page":!0})),buf.push(">"+escape(null==(interp=a.fill)?"":interp)+"</li>")}else{var t=0;for(var e in pages){t++;var a=pages[e];buf.push("\n  <li"),buf.push(attrs({"data-page":""+a.num,"class":"pagelist-i"},{"data-page":!0})),buf.push(">"+escape(null==(interp=a.fill)?"":interp)+"</li>")}}}.call(this),buf.push("\n</ol>")}return buf.join("")}return pgSelectTempl}),define("views/pg-select-view",["backbone","templates/pgSelectTempl"],function(e,t){var a,s;return a=e.View.extend({className:"bottom-paginator",tagName:"ul",initialize:function(e){return _.extend(this,e),this.fillPageList()},fillPageList:function(){var e,t,a,s,n;for(a=this.liClass="bottom-paginator-i",e=this.$el,e.append("<li class='"+a+" paginator-arrow' data-page='prev'>&lsaquo;</li>"),t=s=1,n=this.total;n>=1?n>=s:s>=n;t=n>=1?++s:--s)e.append("<li class='"+a+"' data-page='"+t+"'>"+t+"</li>");return e.append("<li class='"+a+" paginator-arrow' data-page='next'>&rsaquo;</li>"),this.renderPageList()},assignCurrent:function(e){var t;return"all"===e?this.$el.hide():this.$el.show(),t=$("."+this.liClass),t.each(function(){var t;return t=$(this),t.removeClass("is-current"),t.data("page")===e?t.addClass("is-current"):void 0})},renderPageList:function(){return $(".main-c").append(this.el),this.assignCurrent(this.current)},events:{"click .bottom-paginator-i":"go"},go:function(e){var t,a;return a=$(e.currentTarget).data("page"),t="next"===a?$(".page-select-arrow.m-right"):"prev"===a?$(".page-select-arrow.m-left"):$(".pagelist-i[data-page='"+a+"']"),t.click(),$("html, body").animate({scrollTop:0})}}),s=e.View.extend({el:"#adjustor-pages-container",template:t,initialize:function(e){return _.extend(this,e),$(".bottom-paginator").off().remove(),this.bottomPaginator=new a({current:this.pageNo,total:this.options.pgParams.length,router:this.router}),this.pageNo=this.startPage,this.setEvents(),this.render()},getModelDisplay:function(e){if("selections"===this.dataType)switch(this.sortField){case"date_entered":return e.get("date_entered_simple");case"author":return e.get("source").author.last_name.toUpperCase();case"pub_year":return e.get("source").date_display}else{if("authors"!==this.dataType)return e.get("name").toUpperCase();switch(this.sortField){case"last_name":return e.get("last_name").toUpperCase();case"birth_year":return e.get("birth_year")}}},setEvents:function(){var e=this;return $(".page-select-arrow").off().on("click",function(t){return e.flipPage($(t.currentTarget))})},events:{"click .pagelist-i":"changePage"},changePage:function(e){return this.pageNo=$(e.currentTarget).data("page"),this.pageName=$(e.currentTarget).text(),this.router?(this.router.navigate("page/"+this.pageNo,{trigger:!0}),this.changeSelectedPage()):console.log("No router found.")},changeSelectedPage:function(){var e,t,a;return $("#page-list-current").empty(),t=$(".pagelist-i"),e=t.filter("[data-page='"+this.pageNo+"']"),t.filter(".is-active").removeClass("is-active"),e.addClass("is-active"),a="all"===this.pageNo?"showing "+e.text()+"<br><br>":"showing page "+this.pageNo+" of "+this.pgParams.length+":<br>"+e.text(),$("#page-list-current").html(a),this.bottomPaginator.assignCurrent(this.pageNo)},flipPage:function(e){var t,a,s,n;return a=e.hasClass("m-left")?"prev":"next",t=this.pgParams.length,"all"===this.pageNo?s="prev"===a?t:1:(n=e.hasClass("m-left"),s=1===this.pageNo&&n?t:this.pageNo!==t||n?n?this.pageNo-1:this.pageNo+1:1),$(".pagelist-i").filter("[data-page='"+s+"']").click()},render:function(){var e,t,a,s,n,r,i,l,o,u,h,p;if($(this.el).off().empty(),n=this.pgParams){for(e=this.container||$("#adjustor-pages-container"),i=n.length,s=n[i-1].endIndex+1,e.off(),u={itemCount:s,dataType:this.dataType,pages:[]},a=h=0,p=n.length;p>h;a=++h)r=n[a],o=this.getModelDisplay(r.startModel),t=this.getModelDisplay(r.endModel),l={fill:o!==t?""+o+" to "+t:o,num:a+1},u.pages.push(l);this.$el.append(this.template(u)),e.append(this.el),this.changeSelectedPage()}else console.log("No page details found.");return this}})}),define("views/paginated-collection-view",["backbone"],function(e){var t;return t=e.View.extend({initialize:function(e){return _.extend(this,e),this.render()},render:function(){var e=this;return this.collection&&this.page?this.container.fadeOut("fast",function(){var t,a,s,n,r,i;for(e.container.off().empty(),"all"===e.page?(n=0,t=e.collection.length-1):(r=e.pgParams[e.page-1],n=r.startIndex,t=r.endIndex),a=i=n;t>=n?t>=i:i>=t;a=t>=n?++i:--i)s=new e.View({model:e.collection.models[a],index:a});return e.container.fadeIn("fast",function(){return e.callback?e.callback():void 0})}):console.log("Missing options: requires 'collection' and 'page'."),this}})}),define("views/br-tag-view",["backbone","views/paginated-collection-view"],function(e,t){var a,s;return a=e.View.extend({tagName:"li",initialize:function(){return this.render()},render:function(){var e,t,a,s,n;return a=this.model,s=a.get("slug"),e=a.has("last_name"),t=$("<a />").attr("href",s).addClass("taglist-i"),n=$("<span />").addClass("taglist-i-inner").appendTo(t),e?n.html(""+a.get("full_name")+" <span class='browse-author-dates'>("+a.get("dates")+")</span>"):n.html(a.get("name")),this.$el.append(t),$("#tag-list").append(this.el),$(".main-c").show(),this}}),s=function(e){return new t({collection:e.collection,page:e.page,container:e.container,pgParams:e.pgParams,View:a})}}),require.config({paths:{jade:"/static/gentlereader/scripts/lib/jade-runtime"},shim:{jade:{exports:"jade"}}}),define("templates/selListItemTempl",["jade"],function(jade){function selListItemTempl(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push("\n<section><a"),buf.push(attrs({href:"/selections/"+model.get("slug")},{href:!0})),buf.push('>\n    <h3 class="selectioninlist-title">'+escape(null==(interp=model.get("title"))?"":interp)+'</h3>\n    <div class="selectioninlist-details"><span class="selectioninlist-author">'+escape(null==(interp=model.get("author"))?"":interp)+"</span>"),model.get("from_display")&&buf.push(".&#32;"+(null==(interp=model.get("from_display"))?"":interp)),buf.push("&#32;("+(null==(interp=model.get("date_display"))?"":interp)+'). <span class="selectioninlist-posttime">Posted '+escape(null==(interp=model.get("date_entered"))?"":interp)+'</span>\n    </div></a></section>\n<section class="selectioninlist-teaser"><span class="teaser-text hyphenate">');var __val__=model.get("teaser");buf.push(null==__val__?"":__val__),buf.push("</span><a"),buf.push(attrs({href:"/selections/"+model.get("slug"),"class":"read-on"},{href:!0})),buf.push(">read&nbsp;on</a></section>")}return buf.join("")}return selListItemTempl}),define("views/br-sel-view",["backbone","views/paginated-collection-view","templates/selListItemTempl"],function(e,t,a){var s,n;return s=e.View.extend({tagName:"li",className:"selectioninlist",template:a,initialize:function(){return this.render()},render:function(){var e;return e=this.model,this.$el.append(this.template({model:e})),$("#selection-list").append(this.el),$(".main-c").show(),this}}),n=function(e){return new t({collection:e.collection,page:e.page,container:$("#selection-list"),pgParams:e.pgParams,View:s})}}),define("utils/globals",[],function(){var e;return e={},{getGlobals:function(){return e}}}),define("routers/br-tag-router",["backbone","utils/globals"],function(e,t){var a;return t=t.getGlobals(),a=e.Router.extend({initialize:function(t){return _.extend(this,t),e.history.start({silent:!0})},routes:{"page/:page":"changePage"},changePage:function(e){return t.app.renderSet(e)}})}),define("utils/pagination-details",[],function(){var e;return e=function(e,t){var a,s,n,r,i,l,o,u;for(r=e.models,s=e.length,i=Math.ceil(s/t),l=[],a=function(){var e,a,i;return i=n*t,a=(n+1)*t-1,e=s-1,a>e&&(a=e),l[n]={startIndex:i,startModel:r[i],endIndex:a,endModel:r[a]}},n=o=0,u=i-1;u>=0?u>=o:o>=u;n=u>=0?++o:--o)a(n);return{startEndModels:l,pgCount:i}}}),define("apps/browse-app",["backbone","models/tag-set","views/pg-select-view","views/br-tag-view","views/br-sel-view","routers/br-tag-router","utils/pagination-details","utils/ignore-articles","utils/globals"],function(e,t,a,s,n,r,i,l,o){var u,h;return o=o.getGlobals(),h="selections"===tagType?10:25,u=e.View.extend({settings:{container:$("#tag-list"),dataType:tagType,startPage:1,itemsPerPage:h},sortField:function(){return $(".sort-radio[name='sortField']:checked").val()},initialize:function(){return this.getTags()},theComparator:function(e,t){var a,s,n,r,i;switch(n=$(".sort-radio[name='sortField']:checked").val(),r=$(".sort-radio[name='sortOrder']:checked").val(),n){case"name":a=l(e.get(n).toLowerCase()),s=l(t.get(n).toLowerCase());break;case"last_name":a=e.get(n).toLowerCase(),s=t.get(n).toLowerCase();break;case"author":a=e.get("source").author.last_name,s=t.get("source").author.last_name;break;case"date_entered":a=new Date(e.get("date_entered_simple")),s=new Date(t.get("date_entered_simple"));break;case"birth_year":a=new Date(e.get("birth_year")),s=new Date(t.get("birth_year"));break;case"pub_year":a=e.get("source").pub_year,s=t.get("source").pub_year}return i=s>a?-1:a>s?1:0,"des"===r&&(i=-1*i),i},getTags:function(){var e,a=this;return e=this.tagSet=new t,e.url="/api/"+this.settings.dataType,e.comparator=this.theComparator,e.fetch({error:function(){return console.log("The set couldn't be fetched.")},success:function(){return e.length>a.settings.itemsPerPage?($("#page-and-sort").toggle(),a.router=new r,a.router.navigate("page/"+a.settings.startPage,{replace:!0}),a.start(),a.setEvents()):$(".main-c").show()}})},start:function(){return this.getPages(),this.getPageSelect(),this.renderSet(this.settings.startPage)},getPages:function(){return this.pgParams=i(this.tagSet,this.settings.itemsPerPage).startEndModels},getPageSelect:function(){return this.pgView=new a({pgParams:this.pgParams,router:this.router,dataType:this.settings.dataType,startPage:this.settings.startPage,sortField:this.sortField()})},renderSet:function(e){var t;return t={collection:this.tagSet,page:e,pgParams:this.pgParams,container:this.settings.container},"selections"!==this.settings.dataType?s(t):n(t)},setEvents:function(){var e=this;return $(".sort-radio").off().on("click",function(){return e.reSort()}),$(".adjustor-btn, .x-adjustor").off().on("click",function(t){return e.toggleAdjustors($(t.currentTarget))})},reSort:function(){return this.tagSet.sort(),this.router.navigate("page/"+this.settings.startPage,{trigger:!1}),this.start(),this.setEvents()},toggleAdjustors:function(e){var t;return e.toggleClass("is-active"),t=e.data("adjustor"),"page"===t?$("#adjustor-pages-container").toggleClass("is-active"):"sort"===t?$("#adjustor-sort-container").toggleClass("is-active"):void 0}})}),require(["apps/rand-quot-app","apps/browse-app","utils/globals"],function(e,t,a){var s,n;return n=new e,a=a.getGlobals(),s=a.app=new t}),define("browse-main",function(){});